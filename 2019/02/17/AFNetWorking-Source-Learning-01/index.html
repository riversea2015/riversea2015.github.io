<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ ä¸»ä½“æµç¨‹ | riversea2015</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="article">
<meta property="og:title" content="AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ ä¸»ä½“æµç¨‹">
<meta property="og:url" content="https://devhe.com/2019/02/17/AFNetWorking-Source-Learning-01/index.html">
<meta property="og:site_name" content="riversea2015">
<meta property="og:locale">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2208988-6bf242f27828bbcc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2208988-e9fbf65e04eaf59f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2208988-27f56f36213354ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2019-02-17T15:32:23.000Z">
<meta property="article:modified_time" content="2022-08-27T15:42:05.698Z">
<meta property="article:author" content="He Hai">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/2208988-6bf242f27828bbcc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
  
    <link rel="alternate" href="/atom.xml" title="riversea2015" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">riversea2015</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Stay Hungry, Stay Young.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Buscar"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Buscar"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://devhe.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-AFNetWorking-Source-Learning-01" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/17/AFNetWorking-Source-Learning-01/" class="article-date">
  <time class="dt-published" datetime="2019-02-17T15:32:23.000Z" itemprop="datePublished">2019-02-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ ä¸»ä½“æµç¨‹
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="https://upload-images.jianshu.io/upload_images/2208988-6bf242f27828bbcc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AFNetWorking æºç å­¦ä¹ ç¬”è®°.png"></p>
<span id="more"></span>

<h3 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h3><p><a target="_blank" rel="noopener" href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a> æ˜¯ä½¿ç”¨ Objective-C å¼€å‘ iOS App æ—¶é¦–é€‰çš„ç¬¬ä¸‰æ–¹ç½‘ç»œæ¡†æ¶ï¼Œå½“ç„¶æ—©æœŸè¿˜æœ‰ ASI çš„æ¡†æ¶ï¼Œä¸è¿‡å› ä¸ºé•¿æœŸæ— äººç»´æŠ¤ï¼Œå·²å¾ˆå°‘ä¸äººä½¿ç”¨äº†ã€‚æœ¬ç³»åˆ—ä¸»è¦æ˜¯å¯¹ AFNetWorking (3.2.1) æºç å­¦ä¹ çš„ä¸€ä¸ªè®°å½•ï¼Œå…±åˆ† 5 ç¯‡è¿›è¡Œè®¨è®ºï¼Œç›®å½•å¦‚ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b1c9639207d2">AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ ä¸»ä½“æµç¨‹</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/569e184cc9aa">AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ NSURLSession</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/77e8ab1b231e">AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ Security</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0132afd13e24">AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ Serialization</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/451eb3eebda7">AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ Reachability</a></p>
<p>æœ¬æ–‡æ˜¯ç¬¬ä¸€ç¯‡ï¼Œç®€è¦ä»‹ç»ä¸€ä¸‹æ¡†æ¶ç»“æ„å’Œä¸»ä½“æµç¨‹ã€‚</p>
<h3 id="äºŒã€æ¡†æ¶ç»“æ„"><a href="#äºŒã€æ¡†æ¶ç»“æ„" class="headerlink" title="äºŒã€æ¡†æ¶ç»“æ„"></a>äºŒã€æ¡†æ¶ç»“æ„</h3><p>ä¸ºäº†æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„åˆ‡å…¥ç‚¹ï¼Œé¦–å…ˆæŸ¥çœ‹äº† github ä¸Šçš„æ–‡æ¡£ï¼Œç„¶åæ ¹æ®ç¤ºä¾‹å†™äº†ä¸€ä¸ªç²—ç•¥çš„ <a target="_blank" rel="noopener" href="https://github.com/riversea2015/CodeForBlogs/tree/master/HHAFNetworkingStudy">demo</a>ï¼Œä½¿ç”¨ cocoapods å¯¼å…¥äº† AFNetWorking ä¹‹åï¼ŒæŸ¥çœ‹å…¶æ–‡ä»¶ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2208988-e9fbf65e04eaf59f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AFNetWorking-æ–‡ä»¶ç»“æ„.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé™¤ UIKit ä¹‹å¤–ï¼Œä¸»è¦åˆ†äº† 4 éƒ¨åˆ†ï¼Œå„éƒ¨åˆ†çš„ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š</p>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/569e184cc9aa">NSURLSession</a>ï¼ŒåŒ…æ‹¬ 2 ä¸ªä¸»è¦çš„ç±»ï¼ŒAFHTTPSessionManager å’Œ AFURLSessionManagerï¼Œå‰è€…æä¾›ä¸€äº›å¯¹å¤–æ¥å£ï¼Œå®ƒç»§æ‰¿è‡ª AFURLSessionManager è¿™ä¸ªæ ¸å¿ƒç±»ï¼Œä¸»è¦çš„å·¥ä½œéƒ½åœ¨è¿™é‡Œï¼ŒåŒ…æ‹¬åˆ›å»ºåŠå¯åŠ¨ taskï¼Œä»£ç†æ–¹æ³•çš„å¤„ç†ç­‰ç­‰ã€‚</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/77e8ab1b231e">Security</a>ï¼Œåªæœ‰ä¸€ä¸ªç±» AFSecurityPolicyï¼Œä»£ç ä¹Ÿä¸å¤šï¼Œè´Ÿè´£åœ¨ç³»ç»Ÿåº•å±‚è®¤è¯ HTTPS ä¹‹å‰ï¼ŒAFNetWorking è‡ªå·±åšä¸€æ¬¡è®¤è¯ã€‚</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0132afd13e24">Serialization</a>ï¼ŒåŒ…å« 2 ä¸ªç±»ï¼ŒAFURLRequestSerialization å’Œ AFURLResponseSerialization åˆ†åˆ«è´Ÿè´£è¯·æ±‚å‚æ•°å’Œæ¥å£è¿”å›ç»“æœçš„å¤„ç†ã€‚</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/451eb3eebda7">Reachability</a>ï¼Œæä¾›äº†ä¸€ä¸ªç›‘å¬ç½‘ç»œçŠ¶æ€çš„ç±» AFNetworkReachabilityManagerï¼Œä¸å¤ªå¸¸ç”¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç”¨è‹¹æœæä¾›çš„ Reachability è¿™ä¸ªç±»ï¼Œç„¶åè‡ªå·±å°è£…ä¸€ä¸‹ï¼Œä¸è¿‡éœ€è¦æ‰‹åŠ¨å°†å®ƒçš„ .h&#x2F;.m æ–‡ä»¶å¯¼å…¥åˆ°å·¥ç¨‹é‡Œã€‚</p>
</li>
</ol>
<h3 id="ä¸‰ã€ä¸»ä½“æµç¨‹"><a href="#ä¸‰ã€ä¸»ä½“æµç¨‹" class="headerlink" title="ä¸‰ã€ä¸»ä½“æµç¨‹"></a>ä¸‰ã€ä¸»ä½“æµç¨‹</h3><p>æœ¬æ–‡çš„ demo åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ç½‘ç»œè¯·æ±‚ï¼Œæˆ‘ä»¬ä»¥æ­¤ä½œä¸ºçªç ´å£ï¼Œå¼€å§‹ä¸€æ­¥ä¸€æ­¥ç ”ç©¶è¿™ä¸ªæ¡†æ¶çš„åŸºæœ¬æµç¨‹ã€‚ä¸‹è¾¹æ˜¯è‡ªå·±æ·»åŠ çš„å‘é€è¯·æ±‚çš„ä»£ç ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;ViewController.h&quot;</span><br><span class="line">#import &lt;AFNetworking/AFNetworking.h&gt;</span><br><span class="line"></span><br><span class="line">@interface ViewController ()</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    [self startLoadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)startLoadData &#123;</span><br><span class="line">    // 1.æ‹¼æ¥å‚æ•°</span><br><span class="line">    NSString *urlString          = [[unsplash_ENDPOINT_HOST stringByAppendingString:unsplash_ENDPOINT_POPULAR] stringByAppendingString:unsplash_CONSUMER_KEY_PARAM];</span><br><span class="line">    NSUInteger nextPage          = 1;</span><br><span class="line">    NSString *imageSizeParam     = @&quot;&amp;image_size=600&quot;;</span><br><span class="line">    NSString *urlAdditions       = [NSString stringWithFormat:@&quot;&amp;page=%lu&amp;per_page=%d%@&quot;, (unsigned long)nextPage, 10, imageSizeParam];</span><br><span class="line">    NSString *URLString = [urlString stringByAppendingString:urlAdditions];</span><br><span class="line">    </span><br><span class="line">    // 2.å‘é€è¯·æ±‚</span><br><span class="line">    // *** ç‚¹å¼€æ­¤å¤„ GET æ–¹æ³•</span><br><span class="line">    [[AFHTTPSessionManager manager] GET:URLString parameters:urlAdditions progress:^(NSProgress * _Nonnull downloadProgress) &#123;</span><br><span class="line">        NSLog(@&quot;+++++&gt; è¿›è¡Œä¸­...ï¼š%@&quot;, downloadProgress);</span><br><span class="line">    &#125; success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) &#123;</span><br><span class="line">        NSLog(@&quot;=====&gt; æˆåŠŸï¼š%@&quot;, responseObject);</span><br><span class="line">    &#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</span><br><span class="line">        if (error) &#123;</span><br><span class="line">            NSLog(@&quot;-----&gt; å¤±è´¥åŸå› ï¼š%@&quot;, error.domain);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ GET æ–¹æ³•ä¸Š â€œcommand + å³é”®â€ è·³è½¬åˆ°ä½äº AFHTTPSessionManager.m æ–‡ä»¶ä¸­çš„æ–¹æ³•å®ç°ï¼ˆè§ä¸‹æ–¹ä»£ç ï¼‰ï¼Œåšäº†ä¸¤ä»¶äº‹ï¼š<br>â‘ åˆ›å»º dataTaskï¼›<br>â‘¡å¯åŠ¨ä»»åŠ¡ï¼ˆä½¿ç”¨ resume å¯èƒ½æœ‰æ„Ÿè§‰æœ‰ç‚¹æ€ªï¼Œä¸è¿‡è‹¹æœæ–‡æ¡£ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼Œæ–°åˆ›å»ºçš„ task æ˜¯å¤„äºæŒ‚èµ·çŠ¶æ€çš„ï¼Œéœ€è¦ä½¿ç”¨ resume å¯åŠ¨ä»»åŠ¡ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (NSURLSessionDataTask *)GET:(NSString *)URLString</span><br><span class="line">                   parameters:(id)parameters</span><br><span class="line">                     progress:(void (^)(NSProgress * _Nonnull))downloadProgress</span><br><span class="line">                      success:(void (^)(NSURLSessionDataTask * _Nonnull, id _Nullable))success</span><br><span class="line">                      failure:(void (^)(NSURLSessionDataTask * _Nullable, NSError * _Nonnull))failure</span><br><span class="line">&#123;</span><br><span class="line">    // 1.åˆ›å»ºä»»åŠ¡</span><br><span class="line">    // *** ç‚¹å¼€æ­¤æ–¹æ³•</span><br><span class="line">    NSURLSessionDataTask *dataTask = [self dataTaskWithHTTPMethod:@&quot;GET&quot;</span><br><span class="line">                                                        URLString:URLString</span><br><span class="line">                                                       parameters:parameters</span><br><span class="line">                                                   uploadProgress:nil</span><br><span class="line">                                                 downloadProgress:downloadProgress</span><br><span class="line">                                                          success:success</span><br><span class="line">                                                          failure:failure];</span><br><span class="line">    // 2.å¯åŠ¨ä»»åŠ¡</span><br><span class="line">    [dataTask resume];</span><br><span class="line"></span><br><span class="line">    return dataTask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å†ç‚¹å¼€ dataTaskWithHTTPMethod: æ–¹æ³•ï¼Œçœ‹çœ‹ä»–é‡Œè¾¹ç©¶ç«Ÿåšäº†ä»€ä¹ˆã€‚æˆ‘ä»¬å‘ç°å…¶å®ä¹Ÿå·®ä¸å¤šåšäº†ä¸¤ä»¶äº‹ï¼š<br>â‘ ä½¿ç”¨ requestSerializer è¿™ä¸ªç±»åˆ›å»º NSMutableURLRequest å¯¹è±¡ï¼›<br>â‘¡åˆæ˜¯åˆ›å»º task ï¼Œè¿™é‡Œå°† ä¸Šä¸€æ­¥å¾—åˆ°çš„ request åŠä¸‹è½½ã€ä¸Šä¼ çš„ block ä½œä¸ºå‚æ•°ä¼ å…¥ä¸‹ä¸€å±‚åˆ›å»º task çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½äº AFURLSessionManager ç±»ä¸­ï¼Œå®ƒæ˜¯ AFHTTPSessionManager çš„çˆ¶ç±»ï¼Œä¸»è¦å·¥ä½œéƒ½åœ¨è¿™ä¸ªç±»é‡Œè¾¹å¤„ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">- (NSURLSessionDataTask *)dataTaskWithHTTPMethod:(NSString *)method</span><br><span class="line">                                       URLString:(NSString *)URLString</span><br><span class="line">                                      parameters:(id)parameters</span><br><span class="line">                                  uploadProgress:(nullable void (^)(NSProgress *uploadProgress)) uploadProgress</span><br><span class="line">                                downloadProgress:(nullable void (^)(NSProgress *downloadProgress)) downloadProgress</span><br><span class="line">                                         success:(void (^)(NSURLSessionDataTask *, id))success</span><br><span class="line">                                         failure:(void (^)(NSURLSessionDataTask *, NSError *))failure</span><br><span class="line">&#123;</span><br><span class="line">    // 1.1 æ„å»º NSMutableURLRequestï¼Œå®é™…è°ƒç”¨ requestSerializer ä¸­åˆ›å»º request çš„æ–¹æ³•</span><br><span class="line">    // å› ä¸º NSURLRequest çš„å±æ€§éƒ½æ˜¯ readonlyï¼Œæ‰€ä»¥æ­¤å¤„æ„å»ºäº† NSMutableURLRequestã€‚</span><br><span class="line">    NSError *serializationError = nil;</span><br><span class="line">    // *** ç‚¹å¼€æ­¤æ–¹æ³•</span><br><span class="line">    NSMutableURLRequest *request = [self.requestSerializer requestWithMethod:method</span><br><span class="line">                                                                   URLString:[[NSURL URLWithString:URLString relativeToURL:self.baseURL] absoluteString]</span><br><span class="line">                                                                  parameters:parameters</span><br><span class="line">                                                                       error:&amp;serializationError];</span><br><span class="line">    // æ„å»ºå¤±è´¥çš„å¤„ç†</span><br><span class="line">    if (serializationError) &#123;</span><br><span class="line">        if (failure) &#123;</span><br><span class="line">            dispatch_async(self.completionQueue ?: dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                failure(nil, serializationError);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 1.2 æ„å»º NSURLSessionDataTaskï¼šå®é™…è°ƒç”¨çˆ¶ç±» AFURLSessionManager çš„æ–¹æ³•</span><br><span class="line">    __block NSURLSessionDataTask *dataTask = nil;</span><br><span class="line">    // *** ç‚¹å¼€æ­¤æ–¹æ³•</span><br><span class="line">    dataTask = [self dataTaskWithRequest:request</span><br><span class="line">                          uploadProgress:uploadProgress</span><br><span class="line">                        downloadProgress:downloadProgress</span><br><span class="line">                       completionHandler:^(NSURLResponse * __unused response, id responseObject, NSError *error) &#123;</span><br><span class="line">        if (error) &#123;</span><br><span class="line">            if (failure) &#123;</span><br><span class="line">                failure(dataTask, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (success) &#123;</span><br><span class="line">                success(dataTask, responseObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    return dataTask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°è¿™é‡Œåˆ›å»º request å’Œ åˆ›å»º task çš„æ–¹æ³•è¿˜å¯ç»§ç»­æ·±å…¥ï¼Œå…ˆç‚¹å¼€ requestWithMethod æ–¹æ³•çœ‹çœ‹ï¼Œä»ä¸‹è¾¹çš„ä»£ç ä¸­å¯ä»¥å‘ç°ï¼Œè¿™é‡Œä¸»è¦å°±æ˜¯è°ƒç”¨ç³»ç»Ÿæ–¹æ³•åˆ›å»º NSMutableURLRequestï¼Œç„¶åè®¾ç½®å‚æ•°å¹¶åºåˆ—åŒ–ï¼Œæœ€åå°†è¯¥ request è¿”å›ã€‚</p>
<p>è¿™é‡Œè¯´ä»¶å‡ºç³—çš„äº‹ï¼Œè®°å¾—åˆšå­¦ç¼–ç¨‹çš„æ—¶å€™æ›¾è¢«äººé—®è¿‡ URLRequest æ˜¯å¦å¯ä»¥å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œè¿˜ä¿¡å¿ƒæ»¡æ»¡çš„å›ç­”å¯ä»¥ï¼Œå¿ƒæƒ³ request ç¿»è¯‘è¿‡æ¥å¯ä¸å°±æ˜¯è¯·æ±‚å— ğŸ˜“ã€‚ç®€å•ç‚¹è¯´ï¼Œrequest åœ¨è¿™é‡Œçš„ä½œç”¨å…¶å®å°±æ˜¯æ‹¼è£…å‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- (NSMutableURLRequest *)requestWithMethod:(NSString *)method</span><br><span class="line">                                 URLString:(NSString *)URLString</span><br><span class="line">                                parameters:(id)parameters</span><br><span class="line">                                     error:(NSError *__autoreleasing *)error</span><br><span class="line">&#123;</span><br><span class="line">    // 0.æ£€æµ‹ methodã€URLString æ˜¯å¦ä¸ºç©º</span><br><span class="line">    NSParameterAssert(method);</span><br><span class="line">    NSParameterAssert(URLString);</span><br><span class="line"></span><br><span class="line">    NSURL *url = [NSURL URLWithString:URLString];</span><br><span class="line">    NSParameterAssert(url);    </span><br><span class="line"></span><br><span class="line">    // 1.å¼€å§‹åˆ›å»º NSMutableURLRequestï¼Œå› ä¸º NSURLRequest çš„å±æ€§éƒ½æ˜¯ readonlyï¼Œä¸ºäº†èƒ½å¤Ÿä¿®æ”¹ï¼Œåªèƒ½åˆ›å»ºå¯å˜çš„äº†ã€‚</span><br><span class="line">    NSMutableURLRequest *mutableRequest = [[NSMutableURLRequest alloc] initWithURL:url];</span><br><span class="line">    </span><br><span class="line">    // 2.è®¾ç½®å‚æ•°</span><br><span class="line">    mutableRequest.HTTPMethod = method;</span><br><span class="line"></span><br><span class="line">    // ä¸º request è®¾ç½®å…¶ä¸€äº›é»˜è®¤å‚æ•°</span><br><span class="line">    // AFHTTPRequestSerializerObservedKeyPaths()ï¼šAFHTTPRequestSerializer çš„ 6ä¸ªå±æ€§å¯¹åº” getç‰¹ç„¶ çš„ æ–¹æ³•åstring ç»„æˆçš„æ•°ç»„</span><br><span class="line">    for (NSString *keyPath in AFHTTPRequestSerializerObservedKeyPaths()) &#123;</span><br><span class="line">        // self.mutableObservedChangedKeyPaths ä¸­æ˜¯ å€¼énil çš„å±æ€§å</span><br><span class="line">        // requstSerializer åˆå§‹åŒ–æ—¶ï¼Œåˆ›å»ºäº† self.mutableObservedChangedKeyPaths è¿™ä¸ªç©º mutableSetï¼Œç„¶åï¼Œå¦‚æœè®¾ç½®äº†å¯¹åº”çš„å‚æ•°ï¼Œå®ƒé‡Œè¾¹å°±ä¼šåŠ ä¸Šå¯¹åº”çš„å±æ€§å</span><br><span class="line">        if ([self.mutableObservedChangedKeyPaths containsObject:keyPath]) &#123;</span><br><span class="line">            [mutableRequest setValue:[self valueForKeyPath:keyPath] forKey:keyPath];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 3.å¯¹å‚æ•°è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶èµ‹å€¼ç»™ requestï¼Œå¦å¤–ï¼Œè®¾ç½®å¿…è¦çš„ headerã€‚</span><br><span class="line">    mutableRequest = [[self requestBySerializingRequest:mutableRequest withParameters:parameters error:error] mutableCopy];</span><br><span class="line"></span><br><span class="line">	return mutableRequest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹çœ‹è¿™ä¸€å±‚åˆ›å»º task çš„æ–¹æ³•:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// ä¾›å­ç±»è°ƒç”¨</span><br><span class="line">- (NSURLSessionDataTask *)dataTaskWithRequest:(NSURLRequest *)request</span><br><span class="line">                               uploadProgress:(nullable void (^)(NSProgress *uploadProgress)) uploadProgressBlock</span><br><span class="line">                             downloadProgress:(nullable void (^)(NSProgress *downloadProgress)) downloadProgressBlock</span><br><span class="line">                            completionHandler:(nullable void (^)(NSURLResponse *response, id _Nullable responseObject,  NSError * _Nullable error))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">    // 1.åˆ›å»ºTaskï¼ŒåŒæ—¶ä¿®å¤iOS8ä»¥ä¸‹ç³»ç»Ÿå‡ºç°çš„ä¸€ä¸ªBug</span><br><span class="line">    __block NSURLSessionDataTask *dataTask = nil;</span><br><span class="line">    url_session_manager_create_task_safely(^&#123;</span><br><span class="line">        dataTask = [self.session dataTaskWithRequest:request];</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 2.ä¸º task æ·»åŠ ä»£ç†</span><br><span class="line">    // *** ç‚¹å¼€æ­¤æ–¹æ³•</span><br><span class="line">    [self addDelegateForDataTask:dataTask uploadProgress:uploadProgressBlock downloadProgress:downloadProgressBlock completionHandler:completionHandler];</span><br><span class="line"></span><br><span class="line">    return dataTask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿåšäº† 2 ä»¶äº‹ï¼š</p>
<p>â‘ å…ˆæ˜¯ åˆ©ç”¨ session åˆ›å»º taskï¼ˆè¿™æ˜¯ç³»ç»Ÿæ–¹æ³•ï¼‰ã€‚<br>è¿™é‡Œç”¨äº† self.sessionï¼Œäºæ˜¯æˆ‘ä»¬å›åˆ° AFURLSessionManager çš„åˆå§‹åŒ–æ–¹æ³•é‡Œï¼ŒæŸ¥çœ‹ session çš„åˆ›å»ºè¿‡ç¨‹ï¼Œéå¸¸ç®€å•ï¼Œåªæœ‰ä¸€å¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.session = [NSURLSession sessionWithConfiguration:self.sessionConfiguration delegate:self delegateQueue:self.operationQueue];</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘åªå…³æ³¨ delegateï¼Œè¿™è¯´æ˜ç½‘ç»œè¯·æ±‚è¿‡ç¨‹ä¸­çš„ä»£ç†æ–¹æ³•ï¼Œå°†ä¼šåœ¨ AFURLSessionManager è¿™ä¸ªç±»é‡Œè¾¹å®ç°ã€‚</p>
<p>â‘¡ç„¶å ä¸º task æ·»åŠ ä»£ç†ã€‚<br>æ·»åŠ ä»£ç†çš„æ–¹æ³•æ˜¯å°† delegateï¼ˆAFURLSessionManagerTaskDelegateï¼‰å’Œ task çš„æ ‡è¯†ç»„æˆçš„é”®å€¼å¯¹å­˜å‚¨åœ¨å½“å‰å¯¹è±¡ä¸­çš„ä¸€ä¸ªå­—å…¸é‡Œè¾¹ï¼Œä»¥å¤‡ä½¿ç”¨ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (void)addDelegateForDataTask:(NSURLSessionDataTask *)dataTask</span><br><span class="line">                uploadProgress:(nullable void (^)(NSProgress *uploadProgress)) uploadProgressBlock</span><br><span class="line">              downloadProgress:(nullable void (^)(NSProgress *downloadProgress)) downloadProgressBlock</span><br><span class="line">             completionHandler:(void (^)(NSURLResponse *response, id responseObject, NSError *error))completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    AFURLSessionManagerTaskDelegate *delegate = [[AFURLSessionManagerTaskDelegate alloc] initWithTask:dataTask];</span><br><span class="line">    delegate.manager = self;</span><br><span class="line">    delegate.completionHandler = completionHandler;</span><br><span class="line"></span><br><span class="line">    dataTask.taskDescription = self.taskDescriptionForSessionTasks;</span><br><span class="line">    // ä¿å­˜ task å’Œ delegate çš„å¯¹åº”å…³ç³»åˆ°ä¸€ä¸ªå­—å…¸é‡Œï¼Œå¹¶æ·»åŠ å¯¹ä»»åŠ¡å¼€å§‹å’Œæš‚åœçš„ç›‘å¬</span><br><span class="line">    [self setDelegate:delegate forTask:dataTask];</span><br><span class="line"></span><br><span class="line">    delegate.uploadProgressBlock = uploadProgressBlock;</span><br><span class="line">    delegate.downloadProgressBlock = downloadProgressBlock;</span><br><span class="line">&#125;                                         </span><br></pre></td></tr></table></figure>

<p>è¯·æ±‚å¼€å§‹å‰çš„å‡†å¤‡å·¥ä½œåŸºæœ¬å·²ç»åšå®Œäº†ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹è¯·æ±‚å‘èµ·åéƒ½åšäº†ä»€ä¹ˆï¼Œå½“ç„¶æ˜¯çœ‹ AFURLSessionManager é‡Œè¾¹çš„å®ç°çš„ä»£ç†æ–¹æ³•äº†ï¼Œå› ä¸ºä»£ç†æ–¹æ³•è¾ƒå¤šï¼Œè¿™é‡ŒæŒ‘å…¶ä¸­æœ€é‡è¦çš„ 2 ä¸ªä½œç®€è¦ä»‹ç»ã€‚</p>
<p>1.å¦‚ä½•æ¥å—æŒ‘æˆ˜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">- (void)URLSession:(NSURLSession *)session</span><br><span class="line">didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge</span><br><span class="line"> completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition disposition, NSURLCredential *credential))completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    NSURLSessionAuthChallengeDisposition disposition = NSURLSessionAuthChallengePerformDefaultHandling;</span><br><span class="line">    __block NSURLCredential *credential = nil;</span><br><span class="line"></span><br><span class="line">    if (self.sessionDidReceiveAuthenticationChallenge) &#123;</span><br><span class="line">        disposition = self.sessionDidReceiveAuthenticationChallenge(session, challenge, &amp;credential);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if ([challenge.protectionSpace.authenticationMethod isEqualToString:NSURLAuthenticationMethodServerTrust]) &#123;</span><br><span class="line">            if ([self.securityPolicy evaluateServerTrust:challenge.protectionSpace.serverTrust forDomain:challenge.protectionSpace.host]) &#123;</span><br><span class="line">                credential = [NSURLCredential credentialForTrust:challenge.protectionSpace.serverTrust];</span><br><span class="line">                if (credential) &#123;</span><br><span class="line">                    disposition = NSURLSessionAuthChallengeUseCredential;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    disposition = NSURLSessionAuthChallengePerformDefaultHandling;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                disposition = NSURLSessionAuthChallengeCancelAuthenticationChallenge;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            disposition = NSURLSessionAuthChallengePerformDefaultHandling;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (completionHandler) &#123;</span><br><span class="line">        completionHandler(disposition, credential);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.è¯·æ±‚ç»“æŸæˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void)URLSession:(NSURLSession *)session</span><br><span class="line">              task:(NSURLSessionTask *)task</span><br><span class="line">didCompleteWithError:(NSError *)error</span><br><span class="line">&#123;</span><br><span class="line">    AFURLSessionManagerTaskDelegate *delegate = [self delegateForTask:task];</span><br><span class="line"></span><br><span class="line">    // delegate may be nil when completing a task in the background</span><br><span class="line">    if (delegate) &#123;</span><br><span class="line">        [delegate URLSession:session task:task didCompleteWithError:error];</span><br><span class="line"></span><br><span class="line">        [self removeDelegateForTask:task];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (self.taskDidComplete) &#123;</span><br><span class="line">        self.taskDidComplete(session, task, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬å‘ç»™äº†ä»£ç†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - NSURLSessionTaskDelegate</span><br><span class="line"></span><br><span class="line">- (void)URLSession:(__unused NSURLSession *)session</span><br><span class="line">              task:(NSURLSessionTask *)task</span><br><span class="line">didCompleteWithError:(NSError *)error</span><br><span class="line">&#123;</span><br><span class="line">    __strong AFURLSessionManager *manager = self.manager;</span><br><span class="line"></span><br><span class="line">    __block id responseObject = nil;</span><br><span class="line"></span><br><span class="line">    __block NSMutableDictionary *userInfo = [NSMutableDictionary dictionary];</span><br><span class="line">    userInfo[AFNetworkingTaskDidCompleteResponseSerializerKey] = manager.responseSerializer;</span><br><span class="line"></span><br><span class="line">    //Performance Improvement from #2672</span><br><span class="line">    NSData *data = nil;</span><br><span class="line">    if (self.mutableData) &#123;</span><br><span class="line">        data = [self.mutableData copy];</span><br><span class="line">        //We no longer need the reference, so nil it out to gain back some memory.</span><br><span class="line">        self.mutableData = nil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (self.downloadFileURL) &#123;</span><br><span class="line">        userInfo[AFNetworkingTaskDidCompleteAssetPathKey] = self.downloadFileURL;</span><br><span class="line">    &#125; else if (data) &#123;</span><br><span class="line">        userInfo[AFNetworkingTaskDidCompleteResponseDataKey] = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (error) &#123;</span><br><span class="line">        userInfo[AFNetworkingTaskDidCompleteErrorKey] = error;</span><br><span class="line"></span><br><span class="line">        dispatch_group_async(manager.completionGroup ?: url_session_manager_completion_group(), manager.completionQueue ?: dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            if (self.completionHandler) &#123;</span><br><span class="line">                self.completionHandler(task.response, responseObject, error);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                [[NSNotificationCenter defaultCenter] postNotificationName:AFNetworkingTaskDidCompleteNotification object:task userInfo:userInfo];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        dispatch_async(url_session_manager_processing_queue(), ^&#123;</span><br><span class="line">            NSError *serializationError = nil;</span><br><span class="line">            responseObject = [manager.responseSerializer responseObjectForResponse:task.response data:data error:&amp;serializationError];</span><br><span class="line"></span><br><span class="line">            if (self.downloadFileURL) &#123;</span><br><span class="line">                responseObject = self.downloadFileURL;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (responseObject) &#123;</span><br><span class="line">                userInfo[AFNetworkingTaskDidCompleteSerializedResponseKey] = responseObject;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (serializationError) &#123;</span><br><span class="line">                userInfo[AFNetworkingTaskDidCompleteErrorKey] = serializationError;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            dispatch_group_async(manager.completionGroup ?: url_session_manager_completion_group(), manager.completionQueue ?: dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                if (self.completionHandler) &#123;</span><br><span class="line">                    self.completionHandler(task.response, responseObject, serializationError);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                    [[NSNotificationCenter defaultCenter] postNotificationName:AFNetworkingTaskDidCompleteNotification object:task userInfo:userInfo];</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å››ã€å°ç»“"><a href="#å››ã€å°ç»“" class="headerlink" title="å››ã€å°ç»“"></a>å››ã€å°ç»“</h3><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§æ¦‚äº†è§£äº†ä¸€ä¸‹ AFNetWorking å·¥ä½œçš„ä¸»ä½“æµç¨‹ï¼Œç®€å•ç”»äº†ä¸ªå›¾æ€»ç»“ä¸€ä¸‹ï¼Œå½“ç„¶ç•¥å»äº†å¾ˆå¤šç»†èŠ‚ï¼Œä¸è¿‡éƒ½å°†ä¼šåœ¨åè¾¹çš„ç« èŠ‚ç»§ç»­è®¨è®ºã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2208988-27f56f36213354ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AFNetWorking ä¸»ä½“æµç¨‹.png"></p>
<h3 id="DemoåŠæºç æ³¨é‡Š"><a href="#DemoåŠæºç æ³¨é‡Š" class="headerlink" title="DemoåŠæºç æ³¨é‡Š"></a>DemoåŠæºç æ³¨é‡Š</h3><p><a target="_blank" rel="noopener" href="https://github.com/riversea2015/CodeForBlogs/tree/master/HHAFNetworkingStudy">HHAFNetworkingStudy</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://devhe.com/2019/02/17/AFNetWorking-Source-Learning-01/" data-id="cl7c2jebz0001lzfy85dcebef" data-title="AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ ä¸»ä½“æµç¨‹" class="article-share-link">Compartir</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/02/23/AFNetWorking-Source-Learning-02/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Nuevo</strong>
      <div class="article-nav-title">
        
          AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ NSURLSession
        
      </div>
    </a>
  
  
    <a href="/2019/02/03/SDWebImage-Source-Learning-05/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Viejo</strong>
      <div class="article-nav-title">SDWebImage æºç å­¦ä¹ ç¬”è®° â˜ SDImageCache</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archivos</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Posts recientes</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/08/24/ijkplayer-Compilation-and-Packaging/">ijkplayer ç¼–è¯‘-æ‰“åŒ…-Podæ”¯æŒ</a>
          </li>
        
          <li>
            <a href="/2022/08/23/Topics-and-mentions-similar-to-Weibo/">iOS UITextView å®ç°ç±»ä¼¼å¾®åšçš„è¯é¢˜ã€æåŠåŠŸèƒ½</a>
          </li>
        
          <li>
            <a href="/2019/03/17/AFNetWorking-Source-Learning-05/">AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ Reachability</a>
          </li>
        
          <li>
            <a href="/2019/03/10/AFNetWorking-Source-Learning-04/">AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ Serialization</a>
          </li>
        
          <li>
            <a href="/2019/03/02/AFNetWorking-Source-Learning-03/">AFNetWorking æºç å­¦ä¹ ç¬”è®° â˜ Security</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 He Hai<br>
      Construido por <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>